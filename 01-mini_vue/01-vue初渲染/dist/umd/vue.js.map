{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/util.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 拿到数组原型上的方法 （原来的方法）\nlet oldArrayProtoMethods = Array.prototype;\n\n// 继承一下ES5的方法\nexport let arrayMethods = Object.create(oldArrayProtoMethods);\n\nlet methods = [\"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\n\nmethods.forEach((method) => {\n  arrayMethods[method] = function (...args) {\n    // this就是observer里的value\n    const result = oldArrayProtoMethods[method].apply(this, args);\n\n    let inserted;\n    let ob = this.__ob__;\n\n    switch (method) {\n      case \"push\": // arr.push({a:1},{b:2})\n      case \"unshift\": //这两个方法都是追加 追加的内容可能是对象类型，应该被再次进行劫持\n        inserted = args;\n        break;\n      case \"splice\": // vue.$set原理\n        inserted = args.slice(2); // arr.splice(0,1,{a:1},{a:1},{a:1})\n      default:\n        break;\n    }\n    \n    if (inserted) ob.observeArray(inserted); // 给数组新增的值也要进行观测\n    return result;\n  };\n});\n","export function defineProperty(target, key, value) {\n  Object.defineProperty(target, key, {\n    enumerable: false, // 不能被枚举，不能被循环出来\n    configurable: false,\n    value,\n  });\n}\n\nexport function proxy(vm, data, key) {\n  Object.defineProperty(vm, key, {\n    // vm.a\n    get() {\n      return vm[data][key]; // vm._data.a\n    },\n    set(newValue) {\n      // vm.a = 100;\n      vm[data][key] = newValue; // vm._data.a = 100;\n    },\n  });\n}\n","import { arrayMethods } from \"./array\";\nimport { defineProperty } from \"../util\";\n\nclass Observer {\n  constructor(value) {\n    // 使用defineProperty 重新定义属性\n\n    // 判断一个对象是否被观测过看他有没有 __ob__这个属性\n    defineProperty(value, \"__ob__\", this);\n    if (Array.isArray(value)) {\n      // 函数劫持/ 切片编程\n      value.__proto__ = arrayMethods;\n      // 观测数组中的对象类型，对象变化也要做一些事\n      this.observeArray(value);\n    } else {\n      this.walk(value);\n    }\n  }\n  observeArray(value) {\n    value.forEach((item) => {\n      observe(item); // 观测数组中的对象类型\n    });\n  }\n\n  walk(data) {\n    let keys = Object.keys(data); // 获取对象的key\n    keys.forEach((key) => {\n      defineReactive(data, key, data[key]); // Vue.util.defineReactive\n    });\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  //注意点1: 嵌套对象的深层监测\n  observe(value);\n\n  Object.defineProperty(data, key, {\n    get() {\n      console.log(`读取了: ${data}${key}`);\n      return value;\n    },\n\n    set(newValue) {\n      if (newValue === value) return;\n      console.log(`准备设置新值了: ${data}${key}`);\n      observe(newValue); // 如果用户将值改为对象继续监控\n      value = newValue;\n    },\n  });\n}\n\nexport function observe(data) {\n  if (typeof data !== \"object\" || data == null) {\n    return data;\n  }\n  if (data.__ob__) {\n    return data;\n  }\n  return new Observer(data);\n}\n","import { observe } from \"./observer/index\";\nimport { proxy } from './util.js';\n\nexport function initState(vm) {\n  // vm.$options\n  const opts = vm.$options;\n  if (opts.props) {\n    initProps(vm);\n  }\n  if (opts.methods) {\n    initMethods(vm);\n  }\n  if (opts.data) {\n    initData(vm);\n  }\n  if (opts.computed) {\n    initComputed(vm);\n  }\n  if (opts.watch) {\n    initWatch(vm);\n  }\n}\n\nfunction initData(vm) {\n  // 数据的初始化操作\n  let data = vm.$options.data;\n  vm._data = data = typeof data == \"function\" ? data.call(vm) : data;\n  \n  // 当我去vm上取属性时 ，帮我将属性的取值代理到vm._data上\n  for(let key in data){\n    proxy(vm,'_data',key);\n  }\n\n  observe(data);\n}\n\nfunction initProps() {}\nfunction initMethods() {}\n\nfunction initComputed() {}\nfunction initWatch() {}\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n    // 初始化状态 （将数据做一个初始化的劫持 当我改变数据时应该更新视图）\n    // vue组件中有很多状态 data props watch computed\n    initState(vm);\n\n    // vue里面核心特性 响应式数据原理\n    // Vue 是一个什么样的框架 MVVM\n    // 数据变化视图会更新，视图变化数据会被影响 \n    // （MVVM）不能跳过数据去更新视图，$ref\n  };\n}\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  this._init(options); // 入口方法,做初始化操作\n}\n\n// 写成一个个的插件进行对原型的扩展\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","apply","inserted","ob","__ob__","slice","observeArray","defineProperty","target","key","value","enumerable","configurable","proxy","vm","data","get","set","newValue","Observer","isArray","__proto__","walk","item","observe","keys","defineReactive","console","log","initState","opts","$options","props","initData","computed","watch","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}